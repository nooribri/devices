<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      direction: rtl;
      background-color: #f0f0f0;
      margin: 0; padding: 0 10px;
    }
    h2 { text-align: center; margin-top: 20px; }
    form {
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
      max-width: 600px;
      margin: 20px auto;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    input, textarea, button {
      padding: 14px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    button {
      background-color: green;
      color: white;
      cursor: pointer;
    }
    button:hover { background-color: darkgreen; }
    .search-container {
      text-align: center;
      margin: 20px auto;
    }
    .search-container input {
      padding: 14px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 300px;
      background-image: url('https://cdn-icons-png.flaticon.com/512/622/622669.png');
      background-size: 18px;
      background-repeat: no-repeat;
      background-position: 10px center;
      padding-right: 35px;
    }
    table {
      width: 100%;
      background: #fff;
      margin: 20px auto;
      border-collapse: collapse;
      box-shadow: 0 0 10px #ccc;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: center;
    }
    th { background-color: #007bff; color: white; }
    .actions button {
      margin: 0 2px;
      padding: 6px 10px;
      font-size: 14px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
    }
    .edit-btn { background-color: #28a745; color: white; }
    .delete-btn { background-color: #dc3545; color: white; }
    .export-buttons {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .footer-button {
      text-align: center;
      margin: 25px;
    }
    @media print {
      form,
      .search-container,
      .export-buttons,
      .footer-button,
      th.actions,
      td.actions {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <h2>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª ÙˆØ£Ø¬Ù‡Ø²Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¥ÙƒØªØ±ÙˆÙ†ÙŠ</h2>

  <form id="deviceForm">
    <input type="text" id="deviceName" name="deviceName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²" required>
    <input type="text" id="deviceType" name="deviceType" placeholder="Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²" required>
    <input type="text" id="serialNumber" name="serialNumber" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ Ù„Ù„Ø¬Ù‡Ø§Ø²" required>
    <input type="text" id="deviceLocation" name="deviceLocation" placeholder="Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ù‡Ø§Ø²" required>
    <textarea id="notes" name="notes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª"></textarea>
    <button type="submit">Ø¥Ø±Ø³Ø§Ù„</button>
    <div id="status"></div>
  </form>

  <div class="search-container">
    <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« ÙÙŠ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„">
  </div>

  <div id="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>

  <table id="deviceTable" style="display:none;">
    <thead>
      <tr>
        <th>Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²</th>
        <th>Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²</th>
        <th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ Ù„Ù„Ø¬Ù‡Ø§Ø²</th>
        <th>Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ù‡Ø§Ø²</th>
        <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
        <th class="actions">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <div class="export-buttons">
    <button onclick="exportToExcel()">ØªØµØ¯ÙŠØ± Excel</button>
    <button onclick="exportToPDF()">ØªØµØ¯ÙŠØ± PDF</button>
    <button onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
  </div>

  <div class="footer-button">
    <button onclick="location.href='index.html'">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbzxMhNY5gMb6e5SXDhyiKlwxHVvDfsdLn3SMhSzIMphrgVPnl81ScWbeyu2NPCJkVeE/exec";

    document.getElementById('deviceForm').addEventListener('submit', e => {
      e.preventDefault();
      const status = document.getElementById("status");
      status.textContent = "Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

      const data = {
        deviceName: deviceForm.deviceName.value,
        deviceType: deviceForm.deviceType.value,
        serialNumber: deviceForm.serialNumber.value,
        deviceLocation: deviceForm.deviceLocation.value,
        notes: deviceForm.notes.value,
        type: "Ø·Ø§Ø¨Ø¹Ø©"  // ğŸ” ØºÙŠÙ‘Ø± Ø¥Ù„Ù‰ "ØªÙˆÙ‚ÙŠØ¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²
      };

      fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify(data)
      })
      .then(res => res.text())
      .then(() => {
        status.textContent = "âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­";
        deviceForm.reset();
        loadData();
      })
      .catch(() => {
        status.textContent = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„";
      });
    });

    function loadData() {
      fetch(scriptURL)
        .then(res => res.json())
        .then(data => {
          const table = document.getElementById("deviceTable");
          const tbody = document.getElementById("tableBody");
          const loading = document.getElementById("loading");

          loading.style.display = "none";
          table.style.display = "table";
          tbody.innerHTML = "";

          data.forEach(row => {
            if (row.type === "Ø·Ø§Ø¨Ø¹Ø©") {  // ğŸ” Ø£Ùˆ "ØªÙˆÙ‚ÙŠØ¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"
              const tr = document.createElement("tr");
              tr.innerHTML = `
                <td>${row.deviceName || ""}</td>
                <td>${row.deviceType || ""}</td>
                <td>${row.serialNumber || ""}</td>
                <td>${row.deviceLocation || ""}</td>
                <td>${row.notes || ""}</td>
                <td class="actions">
                  <button class="edit-btn">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                  <button class="delete-btn">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                </td>
              `;
              tbody.appendChild(tr);
            }
          });
        })
        .catch(() => {
          document.getElementById("loading").textContent = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
        });
    }

    function exportToExcel() {
      const table = document.getElementById("deviceTable");
      const wb = XLSX.utils.table_to_book(table, { sheet: "ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª ÙˆØ£Ø¬Ù‡Ø²Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¥ÙƒØªØ±ÙˆÙ†ÙŠ "});
      XLSX.writeFile(wb, "ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©.xlsx");
    }

    function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation: 'portrait', unit: 'pt', format: 'a4' });

      doc.setFont("Helvetica");
      doc.setFontSize(14);
      doc.text("ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©", 300, 40, { align: "center" });

      const headers = [["Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²", "Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²","Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ Ù„Ù„Ø¬Ù‡Ø§Ø²", "Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ù‡Ø§Ø²", "Ù…Ù„Ø§Ø­Ø¸Ø§Øª"]];
      const data = [];

      document.querySelectorAll("#tableBody tr").forEach(row => {
        const cells = row.querySelectorAll("td");
        if (cells.length >= 5) {
          data.push([
            cells[0].innerText.trim(),
            cells[1].innerText.trim(),
            cells[2].innerText.trim(),
            cells[3].innerText.trim(),
            cells[4].innerText.trim()
          ]);
        }
      });

      doc.autoTable({
        head: headers,
        body: data,
        startY: 60,
        styles: { font: "helvetica", fontSize: 10, halign: 'right' },
        headStyles: { fillColor: [0, 123, 255], textColor: [255, 255, 255] },
        margin: { left: 30, right: 30 }
      });

      doc.save("ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©.pdf");
    }

    document.getElementById("searchInput").addEventListener("keyup", function () {
      const searchValue = this.value.toLowerCase();
      const rows = document.querySelectorAll("#tableBody tr");
      rows.forEach(row => {
        row.style.display = row.textContent.toLowerCase().includes(searchValue) ? "" : "none";
      });
    });

    window.onload = loadData;
  </script>
</body>
</html>
